style("font-family", "'Patua One', sans-serif")<!DOCTYPE html>
<meta charset="utf-8">
<title>New York City Murders 2016</title>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-color.v1.min.js"></script>

<link href="https://fonts.googleapis.com/css?family=Patua+One" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">


<style>
  * {
    background-color: #000;
  }

  h1, h2, h3 {
    font-family: 'Patua One', serif;
    color: #bcbcbc;
  }

  p {
    font-family: 'Roboto', sans-serif;
    color: #bcbcbc;
  }

  .container {
    min-width: 1000px;
    max-width: 1000px;
    padding-left: 10px;
    padding-right: 10px;
  }

  .zip {
    fill: none;
    stroke: #CCC;
    stroke-width: .5px;
  }

  img {
    position: relative;
    width: 100%;
  }

  #title{
    width: 500px;
    position: absolute;
    background-color: transparent;
    color: #d6d5d4;
    top: 100px;
    left: 500px;
  }

  #subtitle {
    width: 500px;
    position: absolute;
    background-color: transparent;
    color: #d6d5d4;
    top: 150px;
    left: 500px;
  }
</style>

<body>
  <div class="container">
    <img src="newyork.jpg" alt="New York City skyline in greyscale">
    <!-- Photo by Markus Sandin http://bit.ly/2mCgt0z -->

    <h1 id="title">Murders in New York City</h1>
    <p id="subtitle">Visualiztions by Pujaa Rajan and Tyler Alicea (pr338 & tra37)<br>
    INFO 5100: Visual Analytics for the Web</p>
    <p>An in-depth look at all of the reported murders and non-negligent
      manslaughter across New York City's five boroughs in 2016. Data provided by the
      <a href="https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Current-YTD/5uac-w243">
      New York City Police Department</a>.</p>
    <h3>Murders by Borough</h3>
    <svg id="countByBorough" height="200" width="1000"></svg>
    <h3>Reports Inside vs. Outside</h3>
    <svg id="countByLocation" height="130" width="1000"></svg>
    <h3>Reported Murders by Location</h2>

    <script>
      // COLORS
      var manhattanColor = "7e3f14",
          bronxColor = "#6a1517",
          brooklynColor = "#194f1a",
          queensColor = "#49355d",
          statenColor = "#133c59";

      // Returns x number of murders reported in JSON file data in borough boro
      function countPerBorough(data, boro){
        var x = 0;
        data.forEach(function(d) {
          if(d.BORO_NM == boro) { x++; };
        });
        return x;
      };

      // Returns x number of murders reported in JSON file data for location (inside
      // or outside) in borough boro
      function countByLocation(data, location, boro) {
        var x = 0;
        data.forEach(function(d){
          if(d.BORO_NM == boro){
            if(d.LOC_OF_OCCUR_DESC == location) { x++; };
          };
        });
        return x;
      };

      var complaintData;

      d3.json("NYPD_Complaint.json", function (error, data) {
        complaintData = data;

        complaintData.forEach(function(d){
          d.CMPLNT_NUM = d.CMPLNT_NUM;
          d.BORO_NM = d.BORO_NM;
          d.LOC_OF_OCCUR_DESC = d.LOC_OF_OCCUR_DESC;
        });

        var svg = d3.select("#countByBorough");

        var xScale = d3.scaleLinear().domain([19, 116]).range([100, 490]);
        svg.append("rect")
        .attr("x", 130)
        .attr("y", 0)
        .attr("height", 30)
        .attr("width", xScale(countPerBorough(complaintData, "MANHATTAN")))
        .style("fill", manhattanColor);

        svg.append("text")
        .attr("x", 140 + xScale(countPerBorough(complaintData, "MANHATTAN")))
        .attr("y", 20)
        .style("fill", "#bcbcbc")
        .style("font-family", "'Roboto', sans-serif")
        .text(countPerBorough(complaintData, "MANHATTAN"));

        svg.append("text")
        .attr("x", 0)
        .attr("y", 20)
        .style("font-family", "'Patua One', sans-serif")
        .style("text-align", "right")
        .style("fill", "#bcbcbc")
        .text("Manhattan");

        svg.append("rect")
        .attr("x", 130)
        .attr("y", 40)
        .attr("height", 30)
        .attr("width", xScale(countPerBorough(complaintData, "QUEENS")))
        .style("fill", queensColor);

        svg.append("text")
        .attr("x", 140 + xScale(countPerBorough(complaintData, "QUEENS")))
        .attr("y", 60)
        .style("font-family", "'Roboto', sans-serif")
        .style("fill", "#bcbcbc")
        .text(countPerBorough(complaintData, "QUEENS"));

        svg.append("text")
        .attr("x", 0)
        .attr("y", 60)
        .style("font-family", "'Patua One', sans-serif")
        .style("text-align", "right")
        .style("fill", "#bcbcbc")
        .text("Queens");

        svg.append("rect")
        .attr("x", 130)
        .attr("y", 80)
        .attr("height", 30)
        .attr("width", xScale(countPerBorough(complaintData, "STATEN ISLAND")))
        .style("fill", statenColor);

        svg.append("text")
        .attr("x", 140 + xScale(countPerBorough(complaintData, "STATEN ISLAND")))
        .attr("y", 100)
        .style("font-family", "'Roboto', sans-serif")
        .style("fill", "#bcbcbc")
        .text(countPerBorough(complaintData, "STATEN ISLAND"));

        svg.append("text")
        .attr("x", 0)
        .attr("y", 100)
        .style("font-family", "'Patua One', sans-serif")
        .style("text-align", "right")
        .style("fill", "#bcbcbc")
        .text("Staten Island");

        svg.append("rect")
        .attr("x", 130)
        .attr("y", 120)
        .attr("height", 30)
        .attr("width", xScale(countPerBorough(complaintData, "BRONX")))
        .style("fill", bronxColor);

        svg.append("text")
        .attr("x", 140 + xScale(countPerBorough(complaintData, "BRONX")))
        .attr("y", 140)
        .style("font-family", "'Roboto', sans-serif")
        .style("fill", "#bcbcbc")
        .text(countPerBorough(complaintData, "BRONX"));

        svg.append("text")
        .attr("x", 0)
        .attr("y", 140)
        .style("font-family", "'Patua One', sans-serif")
        .style("text-align", "right")
        .style("fill", "#bcbcbc")
        .text("Bronx");

        svg.append("rect")
        .attr("x", 130)
        .attr("y", 160)
        .attr("height", 30)
        .attr("width", xScale(countPerBorough(complaintData, "BROOKLYN")))
        .style("fill", brooklynColor);

        svg.append("text")
        .attr("x", 140 + xScale(countPerBorough(complaintData, "BROOKLYN")))
        .attr("y", 180)
        .style("font-family", "'Roboto', sans-serif")
        .style("fill", "#bcbcbc")
        .text(countPerBorough(complaintData, "BROOKLYN"));

        svg.append("text")
        .attr("x", 0)
        .attr("y", 180)
        .style("font-family", "'Patua One', sans-serif")
        .style("text-align", "right")
        .style("fill", "#bcbcbc")
        .text("Brooklyn");

        // Count by location
        var svg = d3.select("#countByLocation");

        var x = 130; //Starting point x for rectangle

        // Inside bar
        svg.append("text")
        .attr("x", 0)
        .attr("y", 20)
        .style("font-family", "'Patua One', sans-serif")
        .style("text-align", "right")
        .style("fill", "#bcbcbc")
        .text("Inside");

        svg.append("rect")
        .attr("x", x)
        .attr("y", 0)
        .attr("height", 30)
        .attr("width", xScale(countByLocation(complaintData, "INSIDE", "MANHATTAN")))
        .style("fill", manhattanColor);

        svg.append("rect")
        .attr("x", x = x + xScale(countByLocation(complaintData, "INSIDE", "MANHATTAN")))
        .attr("y", 0)
        .attr("height", 30)
        .attr("width", xScale(countByLocation(complaintData, "INSIDE", "QUEENS")))
        .style("fill", queensColor);

        svg.append("rect")
        .attr("x", x = x + xScale(countByLocation(complaintData, "INSIDE", "QUEENS")))
        .attr("y", 0)
        .attr("height", 30)
        .attr("width", xScale(countByLocation(complaintData, "INSIDE", "STATEN ISLAND")))
        .style("fill", statenColor);

        svg.append("rect")
        .attr("x", x = x + xScale(countByLocation(complaintData, "INSIDE", "STATEN ISLAND")))
        .attr("y", 0)
        .attr("height", 30)
        .attr("width", xScale(countByLocation(complaintData, "INSIDE", "BRONX")))
        .style("fill", bronxColor);

        svg.append("rect")
        .attr("x", x = x + xScale(countByLocation(complaintData, "INSIDE", "BRONX")))
        .attr("y", 0)
        .attr("height", 30)
        .attr("width", xScale(countByLocation(complaintData, "INSIDE", "BROOKLYN")))
        .style("fill", brooklynColor);

        svg.append("text")
        .attr("x", x + xScale(countByLocation(complaintData, "INSIDE", "BROOKLYN"))
        + 10)
        .attr("y", 20)
        .style("font-family", "'Roboto', sans-serif")
        .style("fill", "#bcbcbc")
        .text("123");

        //Outside bar

        var x = 130; //Starting point x for rectangle

        svg.append("text")
        .attr("x", 0)
        .attr("y", 60)
        .style("font-family", "'Patua One', sans-serif")
        .style("text-align", "right")
        .style("fill", "#bcbcbc")
        .text("Outside");

        svg.append("rect")
        .attr("x", x)
        .attr("y", 40)
        .attr("height", 30)
        .attr("width", xScale(countByLocation(complaintData, "OUTSIDE", "MANHATTAN")))
        .style("fill", manhattanColor);

        svg.append("rect")
        .attr("x", x = x + xScale(countByLocation(complaintData, "OUTSIDE", "MANHATTAN")))
        .attr("y", 40)
        .attr("height", 30)
        .attr("width", xScale(countByLocation(complaintData, "OUTSIDE", "QUEENS")))
        .style("fill", queensColor);

        svg.append("rect")
        .attr("x", x = x + xScale(countByLocation(complaintData, "OUTSIDE", "QUEENS")))
        .attr("y", 40)
        .attr("height", 30)
        .attr("width", xScale(countByLocation(complaintData, "OUTSIDE", "STATEN ISLAND")))
        .style("fill", statenColor);

        svg.append("rect")
        .attr("x", x = x + xScale(countByLocation(complaintData, "OUTSIDE", "STATEN ISLAND")))
        .attr("y", 40)
        .attr("height", 30)
        .attr("width", xScale(countByLocation(complaintData, "OUTSIDE", "BRONX")))
        .style("fill", bronxColor);

        svg.append("rect")
        .attr("x", x = x + xScale(countByLocation(complaintData, "OUTSIDE", "BRONX")))
        .attr("y", 40)
        .attr("height", 30)
        .attr("width", xScale(countByLocation(complaintData, "OUTSIDE", "BROOKLYN")))
        .style("fill", brooklynColor);

        svg.append("text")
        .attr("x", x + xScale(countByLocation(complaintData, "OUTSIDE", "BROOKLYN"))
        + 10)
        .attr("y", 60)
        .style("font-family", "'Roboto', sans-serif")
        .style("fill", "#bcbcbc")
        .text("177");
      });

      // Map
      function loadJSON(callback) {
        var xobj = new XMLHttpRequest();
        xobj.overrideMimeType("application/json");
        xobj.open('GET', 'crimes.json', true);
        xobj.onreadystatechange = function() {
          if (xobj.readyState == 4 && xobj.status == "200") {
          // .open will NOT return a value but simply returns undefined in async mode so use a callback
            callback(xobj.responseText);
          }
        }
        xobj.send(null);
      };

      // Call to function with anonymous callback
      loadJSON(function(response) {
        // Do Something with the response e.g.
        jsonresponse = JSON.parse(response);

        // Assuming json data is wrapped in square brackets as Drew suggests
      });

      var width = 700,
      height = 700;

      var svg = d3.select("body").append("svg")
      .attr("width", width)
      .attr("height", height);

      var projection = d3.geoAlbers()
      .center([0,40.7])
      .rotate([74,0])
      .translate([width/2,height/2])
      .scale(90000);

      var color = d3.scaleOrdinal(d3.schemeCategory10);

      var path = d3.geoPath()
      .projection(projection);
      queue()
      .defer(d3.json, "map.json")
      .await(ready);

      function ready(error, us) {
        svg.append("g")
        .selectAll("path")
        .data(topojson.feature(us, us.objects.nyct2010).features)
        .enter().append("path")
        .attr("d", path);

        svg.selectAll(".tract")
        .data(topojson.feature(us, us.objects.nyct2010).features)
        .enter().append("path")
        .attr('class','tract')
        .attr('fill',function(d,i) { return color(d.properties.BoroCode); })
        .attr("d", path);

        var circles = svg.selectAll("circle").data(jsonresponse);

        // This black box allows us to make the colors darker while still using
        // the d3 color API.
        svg.append("rect")
        .attr("x", 0)
        .attr("y", 0)
        .attr("height", 760)
        .attr("width", 800)
        .style("fill", "#000")
        .style("opacity", .5);

        circles.enter()
        .append("circle").attr("r", 3)
        .style("stroke","#000")
        .style("fill","#bcbcbc")
        .attr("transform", function(d) {
        return "translate(" + projection([
          d.Longitude,
          d.Latitude
          ]) + ")";
        });

      }

      // Map labels
      svg.append("text")
      .attr("x", 270)
      .attr("y", 190)
      .style("font-family", "'Roboto', sans-serif")
      .style("fill", "#bcbcbc")
      .style("font-weight", "bold")
      .text("MANHATTAN");

      svg.append("text")
      .attr("x", 100)
      .attr("y", 415)
      .style("font-family", "'Roboto', sans-serif")
      .style("fill", "#bcbcbc")
      .style("font-weight", "bold")
      .text("STATEN ISLAND");

      svg.append("text")
      .attr("x", 600)
      .attr("y", 50)
      .style("font-family", "'Roboto', sans-serif")
      .style("fill", "#bcbcbc")
      .style("font-weight", "bold")
      .text("BRONX");

      svg.append("text")
      .attr("x", 620)
      .attr("y", 200)
      .style("font-family", "'Roboto', sans-serif")
      .style("fill", "#bcbcbc")
      .style("font-weight", "bold")
      .text("QUEENS");

      svg.append("text")
      .attr("x", 310)
      .attr("y", 575)
      .style("font-family", "'Roboto', sans-serif")
      .style("fill", "#bcbcbc")
      .style("font-weight", "bold")
      .text("BROOKLYN");


    </script>
  </div>
</body>
